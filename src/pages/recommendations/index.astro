---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";

const recommendations = await getCollection("recommendations");
const search = Astro.url.searchParams.get("search") || "";
---

<Layout>
  <main>
    <section class="flex flex-col gap-8">
      <header class="flex flex-col md:flex-row justify-between">
        <h1 class="text-2xl font-bold">Recommendations</h1>
      </header>
      <!-- Crea un buscador que redireccione a /recommendations?search= -->
      <form
        class="flex items-center gap-4"
        action="/recommendations"
        method="GET"
      >
        <input
          type="text"
          name="search"
          placeholder="Buscar por iniciativa..."
          class="border rounded p-2 w-full md:w-1/3"
          value={search}
        />
        <button
          type="submit"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:cursor-pointer"
        >
          Buscar
        </button>
      </form>
      <div class="grid gap-6 lg:grid-cols-2">
        {
          recommendations.map((rec) => {
            const { slug, data } = rec;
            const {
              title,
              code,
              initiative,
              period,
              faculty,
              qualification,
              tags,
              resume,
            } = data;
            if (
              search &&
              !initiative.toLowerCase().includes(search.toLowerCase())
            ) {
              return null; // Skip this recommendation if it doesn't match the search
            }
            return (
              <article class="bg-white rounded-lg shadow-md flex flex-col gap-2 hover:shadow-lg transition-shadow duration-200 [&>*:not(:first-child)]:px-6 [&>*:not(:first-child)]:py-4">
                <header class="mb-4 bg-blue-600 text-white p-8 rounded-t-lg flex flex-col md:flex-row justify-between">
                  <h2 class="text-xl font-bold">{title}</h2>
                  <span class="text-sm bg-white/20 px-2 py-1 rounded">
                    Recomendado por una iniciativa estudiantil
                  </span>
                </header>
                <dl class="grid grid-cols-2">
                  <div>
                    <dt class="font-semibold">Period:</dt>
                    <dd>{period}</dd>
                  </div>
                  <div>
                    <dt class="font-semibold">Code:</dt>
                    <dd>{code}</dd>
                  </div>
                  <div>
                    <dt class="font-semibold">Faculty:</dt>
                    <dd>{faculty}</dd>
                  </div>
                  <div>
                    <dt class="font-semibold">Qualification:</dt>
                    <dd>{qualification} ⭐</dd>
                  </div>
                  <div>
                    <dt class="font-semibold">Tags:</dt>
                    <dd>
                      <ul class="pl-4">
                        {tags.map((tag: string) => (
                          <li>- {tag}</li>
                        ))}
                      </ul>
                    </dd>
                  </div>
                </dl>
                <section class="flex flex-col justify-end xl:align-baseline xl:flex-row h-full">
                  <div class="flex-1 flex flex-col justify-end">
                    <h3 class="font-semibold">Resumen de la recomendación:</h3>
                    <p>{resume}</p>
                  </div>
                  {/* Mover link al lado derecho de facultad y calificación */}
                  <div class="flex flex-col justify-end">
                    <a
                      href={`/recommendations/${code}-${initiative.replace(/\s/g, "")}`}
                      class="text-blue-600 border-blue-600 border-solid px-5 py-2 border-2 rounded hover:bg-blue-600 hover:text-white transition-colors"
                    >
                      Leer la recomendación completa
                    </a>
                  </div>
                </section>
              </article>
            );
          })
        }
      </div>
    </section>
  </main>
</Layout>
