---
import type { Course } from "./table/columns";
import { columns } from "./table/columns";
import { DataTable } from "./table/data-table";

// Import direct data from JSON instead of using the database query
import CoursesRaw from "../../migration/json/2025-1.json";
import Id2NameRaw from "../../migration/json/valores_unicos.json";
import { Pill } from "./ui/pill";

export interface Props {
  searchValue?: string
}

const { searchValue = "" } = Astro.props

// Prepare data
const coursesData = CoursesRaw as Record<string, any>;
const id2name: Record<string, string> = Id2NameRaw as Record<string, string>;

// Transform the JSON data directly into the format needed by the table
const coursesWithNames = Object.entries(coursesData).map(([sigle, details]) => ({
  sigle: sigle,
  name: details.name || 'Nombre no disponible',
  credits: details.credits || 0,
  school: details.school || 'No disponible',
  area: details.area || 'No disponible'
})) as Course[];
---

<div class="container mx-auto py-8">
  <div class="mb-8">
    <h1 class="text-4xl font-bold text-gray-900 mb-2">Catálogo de Cursos</h1>
    <p class="text-gray-600">Explora todos los cursos disponibles, filtra por sigla y ordena por diferentes criterios</p>
  </div>
  
  <DataTable data={coursesWithNames} externalSearchValue={searchValue} client:only="react" />

  <div class="mt-8 bg-gray-50 rounded-lg p-6">
    <h2 class="text-xl font-bold text-gray-900 mb-3">Instrucciones de uso</h2>
    <div class="grid md:grid-cols-2 gap-4 text-sm text-gray-700">
      <div>
        <h3 class="font-semibold mb-2">Búsqueda</h3>
        <p>Utiliza el campo de búsqueda para filtrar cursos por sigla.</p>
      </div>
      <div>
        <h3 class="font-semibold mb-2">Ordenamiento</h3>
        <p>Haz clic en los encabezados de las columnas para ordenar los resultados por ese criterio.</p>
      </div>
    </div>
  </div>
</div>